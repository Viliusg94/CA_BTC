"""extends "base.html" %}
Modelio treniravimo maršrutai
---------------------------etrų optimizavimas - BTC Prekybos Sistema{% endblock %}
Šis modulis apibrėžia modelio treniravimo, stebėjimo ir valdymo maršrutus.
"""block styles %}
<style>
    .optimize-card {
        transition: transform 0.3s;
        margin-bottom: 20px;
    }
    
    .optimize-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .param-group {
        border: 1px solid #ddd; saugojimo katalogų
        border-radius: 5px;os.path.dirname(os.path.dirname(os.path.abspath(__file__))), 'models')
        padding: 15px;
        margin-bottom: 15px;obali kintamoji treniravimo progresui sekti
        background-color: #f8f9fa;
    }rted',
    
    .param-input {
        margin-bottom: 10px;total_epochs': 0,
    }'metrics': {
    
    .results-table {
        font-size: 0.9rem;
    }]
    
    .results-table th, .results-table td {
        vertical-align: middle;
    }
    
    .visual-container {)
        height: 400px;
        margin-top: 20px;
    }iravimo puslapis"""
    eturn render_template('training/index.html', title='Modelio treniravimas')
    .progress-container {
        margin-top: 20px;)
    }
</style>rų forma"""
{% endblock %}ain.html', title='Treniruoti modelį')

{% block content %}ning.route('/monitor')
<div class="container">tor():
    <h1 class="my-4">Hiperparametrų optimizavimas</h1>vimo progreso stebėjimas"""
        return render_template('training/monitor.html', title='Treniravimo progresas')
    <div class="row">
        <!-- Kairė pusė - parametrų konfigūracija -->s')
        <div class="col-md-5">
            <div class="card optimize-card">ašas"""
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Optimizavimo konfigūracija</h5>
                </div>edirs(MODELS_DIR)
                <div class="card-body">
                    <form id="optimize-form">models_list = []
                        <!-- Pagrindiniai parametrai -->
                        <div class="mb-3">ir(MODELS_DIR):
                            <label for="model-type" class="form-label">Modelio tipas</label>.json'):
                            <select class="form-select" id="model-type">is
                                <option value="lstm">LSTM</option>
                                <option value="gru">GRU</option>pen(os.path.join(MODELS_DIR, filename), 'r') as f:
                                <option value="cnn">CNN</option>oad(f)
                                <option value="transformer">Transformer</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">get('created_at', 'Nežinoma'),
                            <label for="optimization-method" class="form-label">Optimizavimo metodas</label>', {}),
                            <select class="form-select" id="optimization-method">),
                                <option value="grid">Grid Search</option>
                                <option value="random">Random Search</option>
                                <option value="bayesian">Bayesian Optimization</option>
                            </select>
                        </div>
                        naujausi viršuje)
                        <div class="mb-3"> ''), reverse=True)
                            <label for="max-trials" class="form-label">Maksimalus bandymų skaičius</label>
                            <input type="number" class="form-control" id="max-trials" value="20" min="1" max="100">
                        </div>
                        
                        <div class="mb-3">
                            <label for="objective" class="form-label">Optimizavimo tikslas</label>
                            <select class="form-select" id="objective">
                                <option value="val_accuracy">Validavimo tikslumas</option>R, filename)
                                <option value="val_loss">Validavimo nuostoliai</option>
                                <option value="accuracy">Treniravimo tikslumas</option>le_path):
                                <option value="loss">Treniravimo nuostoliai</option>ml', title='Modelis nerastas'), 404
                            </select>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="early-stopping" checked>
                            <label class="form-check-label" for="early-stopping">"Nežinomas")}')
                                Naudoti ankstyvą sustabdymą
                            </label>
                        </div>
                        
                        <!-- Hiperparametrai -->
                        <h6 class="mt-4 mb-3">Hiperparametrų rėžiai</h6>
                        
                        <!-- Sluoksnių skaičius -->
                        <div class="param-group">
                            <label class="form-label">Sluoksnių skaičius</label>
                            <div class="row param-input">
                                <div class="col">
                                    <label for="layers-min" class="form-label small">Min</label>
                                    <input type="number" class="form-control" id="layers-min" value="1" min="1" max="10">
                                </div>
                                <div class="col">
                                    <label for="layers-max" class="form-label small">Max</label>50),
                                    <input type="number" class="form-control" id="layers-max" value="3" min="1" max="10">
                                </div>
                            </div>
                        </div>
                        ]
                        <!-- Vienetų skaičius -->
                        <div class="param-group">
                            <label class="form-label">Vienetų skaičius sluoksnyje</label>
                            <div class="row param-input">
                                <div class="col">
                                    <label for="units-min" class="form-label small">Min</label>
                                    <input type="number" class="form-control" id="units-min" value="32" min="8" max="512" step="8">
                                </div> args=(parameters,))
                                <div class="col">
                                    <label for="units-max" class="form-label small">Max</label>
                                    <input type="number" class="form-control" id="units-max" value="128" min="8" max="512" step="8">
                                </div>s'})
                            </div>
                        </div>
                        
                        <!-- Mokymosi greitis -->
                        <div class="param-group">
                            <label class="form-label">Mokymosi greitis</label>
                            <div class="row param-input">
                                <div class="col">OST'])
                                    <label for="lr-min" class="form-label small">Min</label>
                                    <input type="number" class="form-control" id="lr-min" value="0.0001" min="0.00001" max="0.1" step="0.0001">
                                </div>
                                <div class="col">
                                    <label for="lr-max" class="form-label small">Max</label>
                                    <input type="number" class="form-control" id="lr-max" value="0.01" min="0.00001" max="0.1" step="0.0001">f'Model_{datetime.now().strftime("%Y%m%d_%H%M%S")}')
                                </div>
                            </div>igtas
                        </div>atus'] != 'Completed':
                        reniravimas dar nebaigtas'})
                        <!-- Dropout rate -->
                        <div class="param-group">
                            <label class="form-label">Dropout Rate</label>
                            <div class="row param-input">
                                <div class="col">
                                    <label for="dropout-min" class="form-label small">Min</label>
                                    <input type="number" class="form-control" id="dropout-min" value="0.1" min="0" max="0.9" step="0.1">
                                </div>
                                <div class="col">
                                    <label for="dropout-max" class="form-label small">Max</label>
                                    <input type="number" class="form-control" id="dropout-max" value="0.5" min="0" max="0.9" step="0.1">eters'],
                                </div>
                            </div>1] if training_progress['metrics']['loss'] else None,
                        </div>']['val_loss'] else None,
                        ['mae'] else None,
                        <div class="d-grid gap-2">ics']['val_mae'][-1] if training_progress['metrics']['val_mae'] else None
                            <button type="submit" class="btn btn-primary">Pradėti optimizavimą</button>
                            <button type="button" class="btn btn-outline-secondary">Atstatyti numatytuosius</button>
                        </div>
                    </form>o pavadinimą
                </div>time.now().strftime('%Y%m%d_%H%M%S')}.json"
            </div>
        </div>
        f:
        <!-- Dešinė pusė - rezultatai ir vizualizacijos -->
        <div class="col-md-7">
            <!-- Progreso kortelė --> 'filename': filename})
            <div class="card optimize-card progress-container" id="progress-card" style="display: none;">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">Optimizavimo progresas</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Progresas: <strong id="progress-value">0%</strong></span>
                        <span>Bandymas: <strong id="current-trial">0</strong> / <strong id="max-trials-display">20</strong></span>
                    </div>
                    <div class="progress mb-3">Ruošiami duomenys...')
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" id="progress-bar"></div>
                    </div>
                    
                    <div class="d-flex justify-content-between">s'] = 'Creating model'
                        <span>Geriausias rezultatas: <strong id="best-result">-</strong></span>
                        <button class="btn btn-sm btn-danger" id="stop-button">Nutraukti</button>is...')
                    </div>
                </div>
            </div>
            
            <!-- Rezultatų kortelė -->
            <div class="card optimize-card" id="results-card">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">Optimizavimo rezultatai</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">epochai
                        <table class="table table-striped table-bordered results-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Sluoksniai</th>
                                    <th>Vienetai</th>
                                    <th>Mokymosi greitis</th>
                                    <th>Dropout</th> 0.8
                                    <th>Val. tikslumas</th>
                                    <th>Veiksmai</th>
                                </tr>nd(loss)
                            </thead>l_loss)
                            <tbody id="results-body">
                                <!-- Rezultatų eilutės bus pridėtos dinamiškai -->
                                <tr>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>64</td>
                                    <td>0.001</td>
                                    <td>0.3</td>nd(f'Epocha {epoch}/{epochs} - loss: {loss:.4f}, val_loss: {val_loss:.4f}, mae: {mae:.4f}, val_mae: {val_mae:.4f}')
                                    <td>0.92</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary">Naudoti</button>
                                    </td>
                                </tr>
                                <tr>ing'
                                    <td>2</td>
                                    <td>3</td>s'].append('Modelis įvertinamas...')
                                    <td>128</td>
                                    <td>0.0005</td>
                                    <td>0.2</td>
                                    <td>0.88</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary">Naudoti</button>as sėkmingai!')
                                    </td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>1</td>
                                    <td>32</td>
                                    <td>0.002</td>
                                    <td>0.4</td>
                                    <td>0.75</td>rodytas failo pavadinimas'})
                                    <td>
                                        <button class="btn btn-sm btn-primary">Naudoti</button>
                                    </td>ame)
                                </tr>
                            </tbody>
                        </table> False, 'message': 'Modelis nerastas'})
                    </div>
                    
                    <div class="mt-3 d-flex justify-content-end">
                        <button class="btn btn-outline-primary me-2">Eksportuoti rezultatus</button>
                        <button class="btn btn-success">Treniruoti geriausią modelį</button>
                    </div>
                </div>litext(file_path)[0] + '.h5'
            </div>
            
            <!-- Vizualizacijos kortelė -->
            <div class="card optimize-card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Parametrų erdvės vizualizacija</h5>'})
                </div>
                <div class="card-body">lename>')
                    <div class="visual-container" id="param-visualization">
                        <!-- Čia bus įterpta grafiko vizualizacija -->
                        <div class="text-center py-5 text-muted">
                            <i class="fas fa-chart-scatter fa-3x mb-3"></i>
                            <p>Čia bus rodoma hiperparametrų erdvės vizualizacija po optimizavimo paleidimo.</p>
                        </div>
                    </div>/404.html', title='Modelis nerastas'), 404
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
gavimui"""
{% block scripts %}ja
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>ODELS_DIR, filename)
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const optimizeForm = document.getElementById('optimize-form');odelis nerastas'})
        const progressCard = document.getElementById('progress-card');
        const progressBar = document.getElementById('progress-bar');
        const progressValue = document.getElementById('progress-value');
        const currentTrial = document.getElementById('current-trial');
        const maxTrialsDisplay = document.getElementById('max-trials-display');
        const bestResult = document.getElementById('best-result');
        const stopButton = document.getElementById('stop-button');
        
        // Pavyzdinis optimizavimo paleidimas: model_data.get('parameters', {})
        optimizeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            ss': False, 'message': f'Klaida skaitant modelio duomenis: {str(e)}'})
            // Rodyti progreso kortelę
            progressCard.style.display = 'block';ory')
            ry():
            // Nustatyti pradinius progreso rodiklius
            const maxTrials = document.getElementById('max-trials').value;reniravimo sesijų istoriją/žurnalą
            maxTrialsDisplay.textContent = maxTrials;"
            currentTrial.textContent = '0';te pridėti logiką, kuri gaus treniravimo sesijų istoriją
            progressBar.style.width = '0%';    # Kol kas grąžiname tik šabloną
            progressValue.textContent = '0%';emplate('training/history.html', title='Treniravimo istorija')
            
            // Simuliuoti optimizavimo procesą
            let trial = 0;
            const interval = setInterval(function() {
                trial++;odelių išsaugojimus (checkpoints)
                currentTrial.textContent = trial;
                 tarpinių modelių išsaugojimų atvaizdavimui
                const progress = (trial / maxTrials) * 100;ate('training/checkpoints.html', title='Tarpiniai modelių išsaugojimai')
                progressBar.style.width = progress + '%';
                progressValue.textContent = Math.round(progress) + '%';
                
                // Simuliuoti rezultatą
                const accuracy = 0.7 + Math.random() * 0.25;
                if (bestResult.textContent === '-' || parseFloat(bestResult.textContent) < accuracy) {
                    bestResult.textContent = accuracy.toFixed(4);
                }
                ning/optimize.html', title='Hiperparametrų optimizavimas')    # Čia bus logika hiperparametrų optimizavimui    """    Hiperparametrų optimizavimo puslapis    """def optimize():@training.route('/optimize')        learning_rate: []
                // Baigti, kai pasiekiamas maksimalus bandymų skaičius
                if (trial >= maxTrials) {
                    clearInterval(interval);i parametro reikšmę
                }alue(parameterName) {
            }, 500);
            
            // Nutraukimo mygtukasę pagal parametro tipą
            stopButton.addEventListener('click', function() {
                clearInterval(interval);l_type':
            });ument.getElementById('modelTypeToAdd').value;
        });
    });rs':
</script>nt.getElementById('layersToAdd').value;
{% endblock %}        })
        .catch(error => {
            console.error('Klaida:', error);
            alert('Įvyko klaida bandant pradėti optimizavimą!');
        });
    }
</script>
{% endblock %}