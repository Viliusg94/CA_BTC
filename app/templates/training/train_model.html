{% extends "base.html" %}

{% block title %}Treniruoti naują modelį - BTC Prekybos Sistema{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h1>Treniruoti naują modelį</h1>
            <p class="text-muted">Nustatykite modelio parametrus ir pradėkite treniravimo procesą.</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Modelio parametrai</h5>
                </div>
                <div class="card-body">
                    <form id="trainModelForm" method="POST" action="{{ url_for('training.start_training') }}">
                        <!-- Modelio pavadinimas -->
                        <div class="mb-3">
                            <label for="model_name" class="form-label">Modelio pavadinimas</label>
                            <input type="text" class="form-control" id="model_name" name="model_name" 
                                   placeholder="Pvz.: LSTM_Model_v1" required>
                            <div class="form-text">Unikalus modelio pavadinimas</div>
                        </div>
                        
                        <!-- Modelio tipas -->
                        <div class="mb-3">
                            <label class="form-label">Modelio tipas</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="model_type" id="model_type_lstm" value="LSTM" checked>
                                <label class="form-check-label" for="model_type_lstm">LSTM</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="model_type" id="model_type_gru" value="GRU">
                                <label class="form-check-label" for="model_type_gru">GRU</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="model_type" id="model_type_cnn" value="CNN-LSTM">
                                <label class="form-check-label" for="model_type_cnn">CNN-LSTM</label>
                            </div>
                        </div>
                        
                        <h5 class="mt-4 mb-3">Architektūros parametrai</h5>
                        
                        <!-- Sluoksnių skaičius -->
                        <div class="mb-3">
                            <label for="layers" class="form-label">Sluoksnių skaičius</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="layers_range" min="1" max="5" step="1" value="2" oninput="updateTextInput('layers')">
                                <input type="number" class="form-control" id="layers" name="layers" min="1" max="5" value="2" onchange="updateRangeInput('layers')">
                            </div>
                        </div>
                        
                        <!-- Neuronų skaičius -->
                        <div class="mb-3">
                            <label for="units" class="form-label">Neuronų skaičius sluoksnyje</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="units_range" min="16" max="256" step="16" value="64" oninput="updateTextInput('units')">
                                <input type="number" class="form-control" id="units" name="units" min="16" max="256" value="64" onchange="updateRangeInput('units')">
                            </div>
                        </div>
                        
                        <!-- Dropout -->
                        <div class="mb-3">
                            <label for="dropout" class="form-label">Dropout</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="dropout_range" min="0" max="0.5" step="0.05" value="0.2" oninput="updateTextInput('dropout')">
                                <input type="number" class="form-control" id="dropout" name="dropout" min="0" max="0.5" step="0.05" value="0.2" onchange="updateRangeInput('dropout')">
                            </div>
                        </div>
                        
                        <h5 class="mt-4 mb-3">Treniravimo parametrai</h5>
                        
                        <!-- Epochos -->
                        <div class="mb-3">
                            <label for="epochs" class="form-label">Epochų skaičius</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="epochs_range" min="10" max="200" step="10" value="50" oninput="updateTextInput('epochs')">
                                <input type="number" class="form-control" id="epochs" name="epochs" min="10" max="200" value="50" onchange="updateRangeInput('epochs')">
                            </div>
                        </div>
                        
                        <!-- Batch dydis -->
                        <div class="mb-3">
                            <label for="batch_size" class="form-label">Batch dydis</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="batch_size_range" min="8" max="128" step="8" value="32" oninput="updateTextInput('batch_size')">
                                <input type="number" class="form-control" id="batch_size" name="batch_size" min="8" max="128" value="32" onchange="updateRangeInput('batch_size')">
                            </div>
                        </div>
                        
                        <!-- Mokymosi greitis -->
                        <div class="mb-3">
                            <label for="learning_rate" class="form-label">Mokymosi greitis</label>
                            <select class="form-select" id="learning_rate" name="learning_rate">
                                <option value="0.1">0.1</option>
                                <option value="0.01">0.01</option>
                                <option value="0.001" selected>0.001</option>
                                <option value="0.0001">0.0001</option>
                                <option value="0.00001">0.00001</option>
                            </select>
                        </div>
                        
                        <h5 class="mt-4 mb-3">Duomenų parametrai</h5>
                        
                        <!-- Sekos ilgis -->
                        <div class="mb-3">
                            <label for="sequence_length" class="form-label">Sekos ilgis (dienos)</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="sequence_length_range" min="10" max="120" step="5" value="60" oninput="updateTextInput('sequence_length')">
                                <input type="number" class="form-control" id="sequence_length" name="sequence_length" min="10" max="120" value="60" onchange="updateRangeInput('sequence_length')">
                            </div>
                        </div>
                        
                        <!-- Prognozės horizontas -->
                        <div class="mb-3">
                            <label for="prediction_days" class="form-label">Prognozės horizontas (dienos)</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="prediction_days_range" min="1" max="14" step="1" value="1" oninput="updateTextInput('prediction_days')">
                                <input type="number" class="form-control" id="prediction_days" name="prediction_days" min="1" max="14" value="1" onchange="updateRangeInput('prediction_days')">
                            </div>
                        </div>
                        
                        <!-- Test size -->
                        <div class="mb-3">
                            <label for="test_size" class="form-label">Testavimo dalies dydis</label>
                            <div class="input-group">
                                <input type="range" class="form-range" id="test_size_range" min="0.1" max="0.5" step="0.05" value="0.2" oninput="updateTextInput('test_size')">
                                <input type="number" class="form-control" id="test_size" name="test_size" min="0.1" max="0.5" step="0.05" value="0.2" onchange="updateRangeInput('test_size')">
                            </div>
                        </div>
                        
                        <!-- Normalizacija -->
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="normalization" name="normalization" checked>
                            <label class="form-check-label" for="normalization">Taikyti duomenų normalizaciją</label>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">Pradėti treniravimą</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Paskutiniai treniruoti modeliai</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for model in recent_models %}
                        <a href="{{ url_for('training.model_details', filename=model.filename) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            {{ model.name }}
                            <span class="badge bg-primary rounded-pill">{{ model.final_metrics.val_loss|round(4) }}</span>
                        </a>
                        {% else %}
                        <p class="text-muted">Dar nėra treniruotų modelių.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Paaiškinimas</h5>
                </div>
                <div class="card-body">
                    <p><strong>Sluoksnių skaičius:</strong> Daugiau sluoksnių gali atpažinti sudėtingesnius modelius, bet gali būti sunkiau apmokyti.</p>
                    <p><strong>Neuronų skaičius:</strong> Didesnis skaičius leidžia atpažinti sudėtingesnes struktūras, bet ilgina treniravimo laiką.</p>
                    <p><strong>Dropout:</strong> Padeda išvengti overfitting problemos, atsitiktinai išjungiant dalį neuronų treniravimo metu.</p>
                    <p><strong>Epochos:</strong> Kuo daugiau epochų, tuo ilgiau treniruojama, bet per daug gali sukelti overfitting.</p>
                    <p><strong>Batch dydis:</strong> Didesnis batch leidžia greičiau mokytis, bet gali prireikti daugiau atminties.</p>
                    <p><strong>Sekos ilgis:</strong> Kiek istorinių dienų duomenų naudoti vienai prognozei.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Funkcija atnaujinti tekstinį lauką, kai keičiasi slankiklis
    function updateTextInput(id) {
        document.getElementById(id).value = document.getElementById(id + '_range').value;
    }
    
    // Funkcija atnaujinti slankiklį, kai keičiasi tekstinis laukas
    function updateRangeInput(id) {
        document.getElementById(id + '_range').value = document.getElementById(id).value;
    }
    
    // Formos patikrinimas prieš pateikimą
    document.getElementById('trainModelForm').addEventListener('submit', function(event) {
        // Čia būtų galima pridėti formų validavimą
        const modelName = document.getElementById('model_name').value;
        if (!modelName) {
            alert('Prašome įvesti modelio pavadinimą!');
            event.preventDefault();
            return;
        }
        
        // Rodome patvirtinimo pranešimą
        if (!confirm('Ar tikrai norite pradėti modelio treniravimą? Šis procesas gali užtrukti keletą minučių ar ilgiau.')) {
            event.preventDefault();
        }
    });
</script>
{% endblock %}