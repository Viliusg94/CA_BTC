{% extends 'base.html' %}

{% block title %}Tarpiniai modelių išsaugojimai{% endblock %}

{% block styles %}
<style>
    .checkpoint-card {
        transition: transform 0.3s;
        margin-bottom: 20px;
    }
    
    .checkpoint-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .checkpoint-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .checkpoint-metrics {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }
    
    .metric-badge {
        font-size: 0.85rem;
        padding: 0.4em 0.7em;
    }
    
    .checkpoint-actions {
        margin-top: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">Tarpiniai modelių išsaugojimai</h1>
    
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="btn-group" role="group">
                <a href="{{ url_for('training.train') }}" class="btn btn-outline-primary">Naujas treniravimas</a>
                <a href="{{ url_for('training.training_history') }}" class="btn btn-outline-info">Treniravimo istorija</a>
                <a href="{{ url_for('models.model_comparison') }}" class="btn btn-outline-success">Modelių palyginimas</a>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Ieškoti išsaugojimų..." id="checkpoint-search">
                <button class="btn btn-outline-secondary" type="button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Filtrai -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Filtrai</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <label for="model-filter" class="form-label">Modelis</label>
                    <select id="model-filter" class="form-select">
                        <option value="">Visi modeliai</option>
                        <option value="lstm">LSTM</option>
                        <option value="cnn">CNN</option>
                        <option value="transformer">Transformer</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="date-filter" class="form-label">Data</label>
                    <select id="date-filter" class="form-select">
                        <option value="">Visos datos</option>
                        <option value="today">Šiandien</option>
                        <option value="week">Šią savaitę</option>
                        <option value="month">Šį mėnesį</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="accuracy-filter" class="form-label">Min. tikslumas</label>
                    <input type="range" class="form-range" id="accuracy-filter" min="0" max="100" step="5" value="0">
                    <div class="d-flex justify-content-between">
                        <small>0%</small>
                        <small id="accuracy-value">0%</small>
                        <small>100%</small>
                    </div>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button id="apply-filters" class="btn btn-primary w-100">Taikyti filtrus</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Išsaugojimų sąrašas -->
    <div id="checkpoints-container">
        <!-- Pavyzdinis išsaugojimas 1 -->
        <div class="card checkpoint-card">
            <div class="card-header bg-light checkpoint-header">
                <h5 class="card-title mb-0">LSTM modelis (Epocha 50/100)</h5>
                <span class="badge bg-success">Geriausias</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <p><strong>Modelis:</strong> LSTM_v1</p>
                        <p><strong>Išsaugojimo laikas:</strong> 2023-04-15 15:32:10</p>
                        <p><strong>Treniravimo progresas:</strong> 50/100 epochų</p>
                        
                        <div class="checkpoint-metrics">
                            <span class="badge bg-primary metric-badge">Tikslumas: 0.92</span>
                            <span class="badge bg-info metric-badge">Nuostoliai: 0.18</span>
                            <span class="badge bg-warning metric-badge">Val. tikslumas: 0.89</span>
                            <span class="badge bg-danger metric-badge">Val. nuostoliai: 0.25</span>
                        </div>
                        
                        <div class="progress mt-3">
                            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="d-flex flex-column h-100 justify-content-center">
                            <p class="mb-2"><strong>Disko vieta:</strong> 24.5 MB</p>
                            <p><strong>Parametrų skaičius:</strong> 124,532</p>
                        </div>
                    </div>
                </div>
                
                <div class="checkpoint-actions">
                    <button class="btn btn-sm btn-primary">Atstatyti modelį</button>
                    <button class="btn btn-sm btn-info">Peržiūrėti detales</button>
                    <button class="btn btn-sm btn-success">Eksportuoti</button>
                    <button class="btn btn-sm btn-danger">Pašalinti</button>
                </div>
            </div>
        </div>
        
        <!-- Pavyzdinis išsaugojimas 2 -->
        <div class="card checkpoint-card">
            <div class="card-header bg-light checkpoint-header">
                <h5 class="card-title mb-0">CNN modelis (Epocha 30/50)</h5>
                <span class="badge bg-secondary">Reguliarus</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <p><strong>Modelis:</strong> CNN_v2</p>
                        <p><strong>Išsaugojimo laikas:</strong> 2023-04-12 11:15:45</p>
                        <p><strong>Treniravimo progresas:</strong> 30/50 epochų</p>
                        
                        <div class="checkpoint-metrics">
                            <span class="badge bg-primary metric-badge">Tikslumas: 0.84</span>
                            <span class="badge bg-info metric-badge">Nuostoliai: 0.32</span>
                            <span class="badge bg-warning metric-badge">Val. tikslumas: 0.81</span>
                            <span class="badge bg-danger metric-badge">Val. nuostoliai: 0.38</span>
                        </div>
                        
                        <div class="progress mt-3">
                            <div class="progress-bar progress-bar-striped bg-primary" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100">60%</div>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="d-flex flex-column h-100 justify-content-center">
                            <p class="mb-2"><strong>Disko vieta:</strong> 18.3 MB</p>
                            <p><strong>Parametrų skaičius:</strong> 86,224</p>
                        </div>
                    </div>
                </div>
                
                <div class="checkpoint-actions">
                    <button class="btn btn-sm btn-primary">Atstatyti modelį</button>
                    <button class="btn btn-sm btn-info">Peržiūrėti detales</button>
                    <button class="btn btn-sm btn-success">Eksportuoti</button>
                    <button class="btn btn-sm btn-danger">Pašalinti</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tuščias rezultatas -->
    <div id="no-checkpoints" class="alert alert-info text-center" style="display: none;">
        <i class="fas fa-info-circle me-2"></i> Nerasta tarpinių modelių išsaugojimų, atitinkančių jūsų kriterijus.
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Paieškos funkcionalumas
        const searchInput = document.getElementById('checkpoint-search');
        const checkpointsContainer = document.getElementById('checkpoints-container');
        const noCheckpoints = document.getElementById('no-checkpoints');
        
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            let resultsFound = false;
            
            // Ieškoti visuose išsaugojimuose
            const checkpointCards = checkpointsContainer.querySelectorAll('.checkpoint-card');
            
            checkpointCards.forEach(card => {
                const cardText = card.textContent.toLowerCase();
                if (cardText.includes(searchTerm)) {
                    card.style.display = 'block';
                    resultsFound = true;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Rodyti/slėpti "nėra rezultatų" pranešimą
            noCheckpoints.style.display = resultsFound ? 'none' : 'block';
        });
        
        // Tikslumo filtro reikšmės atvaizdavimas
        const accuracyFilter = document.getElementById('accuracy-filter');
        const accuracyValue = document.getElementById('accuracy-value');
        
        accuracyFilter.addEventListener('input', function() {
            accuracyValue.textContent = this.value + '%';
        });
        
        // Filtrų taikymas
        const applyFilters = document.getElementById('apply-filters');
        const modelFilter = document.getElementById('model-filter');
        const dateFilter = document.getElementById('date-filter');
        
        applyFilters.addEventListener('click', function() {
            const modelValue = modelFilter.value.toLowerCase();
            const dateValue = dateFilter.value;
            const accuracyValue = parseInt(accuracyFilter.value) / 100;
            
            let resultsFound = false;
            
            const checkpointCards = checkpointsContainer.querySelectorAll('.checkpoint-card');
            
            checkpointCards.forEach(card => {
                const cardText = card.textContent.toLowerCase();
                const accuracyText = card.querySelector('.badge.bg-primary').textContent;
                const accuracyNumber = parseFloat(accuracyText.replace('Tikslumas: ', ''));
                
                let showCard = true;
                
                // Modelio filtras
                if (modelValue && !cardText.includes(modelValue)) {
                    showCard = false;
                }
                
                // Datos filtras - supaprastintas pavyzdys
                if (dateValue) {
                    // Čia būtų realesnė datos lyginimo logika...
                    if (dateValue === 'today' && !cardText.includes('2023-04-15')) {
                        showCard = false;
                    } else if (dateValue === 'week' && !cardText.includes('2023-04')) {
                        showCard = false;
                    }
                }
                
                // Tikslumo filtras
                if (accuracyNumber < accuracyValue) {
                    showCard = false;
                }
                
                if (showCard) {
                    card.style.display = 'block';
                    resultsFound = true;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Rodyti/slėpti "nėra rezultatų" pranešimą
            noCheckpoints.style.display = resultsFound ? 'none' : 'block';
        });
    });
</script>
{% endblock %}