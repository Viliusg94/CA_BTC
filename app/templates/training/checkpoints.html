{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Navigacija atgal -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>Modelio išsaugojimai</h1>
            <p class="text-muted">Modelio apmokymų metu išsaugoti tarpiniai būsenų išsaugojimai</p>
        </div>
        <div class="btn-group">
            <a href="{{ url_for('model_training.model_details', filename=model.filename) }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Grįžti į modelį
            </a>
        </div>
    </div>
    
    <!-- Informacinis blokas -->
    <div class="alert alert-info mb-4">
        <div class="d-flex">
            <div class="me-3">
                <i class="fas fa-info-circle fa-2x"></i>
            </div>
            <div>
                <h5>Apie tarpinius išsaugojimus</h5>
                <p class="mb-0">Tarpiniai išsaugojimai (checkpoints) leidžia išsaugoti modelio būseną įvairiais apmokymo momentais. Jūs galite atkurti modelį iš bet kurio išsaugojimo, lyginant metrikas tarp skirtingų apmokymo etapų, arba naudoti ankstesnę modelio versiją, jei vėlesnėse epochose prasidėjo permokymas (overfitting).</p>
            </div>
        </div>
    </div>
    
    <!-- Išsaugojimų sąrašas -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="card-title mb-0">Išsaugojimų sąrašas</h5>
        </div>
        <div class="card-body">
            {% if checkpoints %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Epocha</th>
                            <th>Data</th>
                            <th>Loss</th>
                            <th>Validation Loss</th>
                            <th>Veiksmai</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for checkpoint in checkpoints %}
                        <tr>
                            <td>{{ checkpoint.epoch }}</td>
                            <td>{{ checkpoint.timestamp }}</td>
                            <td>{{ "%.6f"|format(checkpoint.metrics.loss or 0) }}</td>
                            <td>{{ "%.6f"|format(checkpoint.metrics.val_loss or 0) }}</td>
                            <td>
                                <div class="btn-group">
                                    <a href="{{ url_for('model_training.continue_training', model_id=model.filename, checkpoint_id=checkpoint.filename) }}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-play me-1"></i>Tęsti
                                    </a>
                                    <button class="btn btn-sm btn-danger delete-checkpoint" data-checkpoint-id="{{ checkpoint.filename }}" data-epoch="{{ checkpoint.epoch }}">
                                        <i class="fas fa-trash me-1"></i>Ištrinti
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Šis modelis neturi išsaugojimų. Išsaugojimai sukuriami, kai modelis treniruojamas su įjungtu "Išsaugoti tarpinius taškus" parametru.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}