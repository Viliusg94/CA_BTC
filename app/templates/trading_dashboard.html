<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - Bitcoin Platform</title>
    <!-- ...existing head content... -->
</head>
<body>
    {% extends "base.html" %}

    {% block title %}Prekybos Dashboard{% endblock %}

    {% block content %}
    <div class="container-fluid">
        <h1 class="text-center mb-4">
            <i class="fas fa-chart-line text-primary"></i>
            AI Prekybos Dashboard
        </h1>

        <!-- Modelio pasirinkimas -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h5 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-brain"></i> AI Modelio Pasirinkimas
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="model-select" class="form-label">Pasirinkite AI Modelį Prognozėms:</label>
                                <select id="model-select" class="form-select">
                                    <option value="">Kraunami modeliai...</option>
                                </select>
                                <div class="form-text">Pasirinkite AI modelį prekybos signalų generavimui</div>
                            </div>
                            <div class="col-md-6">
                                <div id="model-info" class="mt-3">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i>
                                        Pasirinkite modelį, kad pamatytumėte jo veikimo metrikas
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <button id="apply-model-btn" class="btn btn-primary" disabled>
                                    <i class="fas fa-check"></i> Pritaikyti Pasirinktą Modelį
                                </button>
                                <button id="refresh-models-btn" class="btn btn-outline-secondary ms-2">
                                    <i class="fas fa-sync-alt"></i> Atnaujinti Modelius
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prekybos signalai -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h5 class="m-0 font-weight-bold text-success">
                            <i class="fas fa-signal"></i> Prekybos Signalai
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="trading-signals">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Prašome pasirinkti ir pritaikyti modelį prekybos signalų generavimui
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Veikimo metrikos -->
        <div class="row">
            <div class="col-md-3">
                <div class="card bg-primary text-white shadow">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                            Šiandienos P/L
                        </div>
                        <div class="h5 mb-0 font-weight-bold" id="daily-pnl">$0.00</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white shadow">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                            Sėkmingų Sandorių %
                        </div>
                        <div class="h5 mb-0 font-weight-bold" id="win-rate">0%</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white shadow">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                            Aktyvūs Signalai
                        </div>
                        <div class="h5 mb-0 font-weight-bold" id="active-signals">0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white shadow">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                            Modelio Tikslumas
                        </div>
                        <div class="h5 mb-0 font-weight-bold" id="model-accuracy">N/A</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        loadAvailableModels();
        
        // Atnaujinti signalus kas 30 sekundžių
        setInterval(updateTradingSignals, 30000);
    });

    function loadAvailableModels() {
        fetch('/api/models/available')
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('model-select');
                select.innerHTML = '<option value="">Pasirinkite modelį...</option>';
                
                if (data.success && data.models) {
                    data.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model.id;
                        option.textContent = `${model.type} (R²: ${model.r2?.toFixed(3) || 'N/A'})`;
                        select.appendChild(option);
                    });
                }
            })
            .catch(error => {
                console.error('Klaida kraunant modelius:', error);
            });
    }

    function updateTradingSignals() {
        fetch('/api/trading/signals')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.signals) {
                    displayTradingSignals(data.signals);
                }
            })
            .catch(error => {
                console.error('Klaida gaunant prekybos signalus:', error);
            });
    }

    function displayTradingSignals(signals) {
        const container = document.getElementById('trading-signals');
        
        if (signals.length === 0) {
            container.innerHTML = '<div class="alert alert-info">Šiuo metu prekybos signalų nėra</div>';
            return;
        }
        
        let html = '<div class="row">';
        signals.forEach(signal => {
            const signalClass = signal.signal === 'BUY' ? 'success' : 
                              signal.signal === 'SELL' ? 'danger' : 'warning';
            
            html += `
                <div class="col-md-6 mb-3">
                    <div class="card border-${signalClass}">
                        <div class="card-body">
                            <h6 class="card-title text-${signalClass}">
                                <i class="fas fa-arrow-${signal.signal === 'BUY' ? 'up' : signal.signal === 'SELL' ? 'down' : 'right'}"></i>
                                ${signal.signal}
                            </h6>
                            <p class="card-text">
                                <strong>Kaina:</strong> $${signal.price?.toFixed(2)}<br>
                                <strong>Pasitikėjimas:</strong> ${(signal.confidence * 100).toFixed(1)}%<br>
                                <strong>Modelis:</strong> ${signal.model_type}<br>
                                <small class="text-muted">${new Date(signal.timestamp).toLocaleString()}</small>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        
        container.innerHTML = html;
    }
    </script>
    {% endblock %}

    {% block scripts %}
    <script src="{{ url_for('static', filename='js/trading-dashboard.js') }}"></script>
    {% endblock %}
</body>
</html>
