{% extends 'base.html' %}

{% block title %}Nauja užduotis{% endblock %}

{% block styles %}
<style>
    .task-form {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .form-section {
        margin-bottom: 30px;
        padding: 20px;
        border-radius: 8px;
        background-color: #f8f9fa;
    }
    
    .section-title {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #dee2e6;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">Sukurti naują užduotį</h1>
    
    <div class="task-form">
        <form method="POST" action="{{ url_for('scheduler.save_task') }}">
            <!-- Pagrindinė informacija -->
            <div class="form-section">
                <h4 class="section-title">Pagrindinė informacija</h4>
                
                <div class="mb-3">
                    <label for="task-name" class="form-label">Užduoties pavadinimas</label>
                    <input type="text" class="form-control" id="task-name" name="name" required>
                </div>
                
                <div class="mb-3">
                    <label for="task-description" class="form-label">Aprašymas</label>
                    <textarea class="form-control" id="task-description" name="description" rows="3"></textarea>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="task-type" class="form-label">Užduoties tipas</label>
                        <select class="form-select" id="task-type" name="task_type" required>
                            <option value="data_collection">Duomenų rinkimas</option>
                            <option value="model_training">Modelio treniravimas</option>
                            <option value="backtest">Strategijos testavimas</option>
                            <option value="report">Ataskaitos generavimas</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="task-priority" class="form-label">Prioritetas</label>
                        <select class="form-select" id="task-priority" name="priority">
                            <option value="low">Žemas</option>
                            <option value="medium" selected>Vidutinis</option>
                            <option value="high">Aukštas</option>
                            <option value="critical">Kritinis</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Planavimo nustatymai -->
            <div class="form-section">
                <h4 class="section-title">Planavimo nustatymai</h4>
                
                <div class="mb-3">
                    <label for="schedule-type" class="form-label">Planavimo tipas</label>
                    <select class="form-select" id="schedule-type" name="schedule_type">
                        <option value="one_time">Vienkartinė</option>
                        <option value="recurring">Pasikartojanti</option>
                    </select>
                </div>
                
                <div id="one-time-options">
                    <div class="mb-3">
                        <label for="scheduled-date" class="form-label">Suplanuota data</label>
                        <input type="date" class="form-control" id="scheduled-date" name="scheduled_date">
                    </div>
                    
                    <div class="mb-3">
                        <label for="scheduled-time" class="form-label">Suplanuotas laikas</label>
                        <input type="time" class="form-control" id="scheduled-time" name="scheduled_time">
                    </div>
                </div>
                
                <div id="recurring-options" style="display: none;">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="recurrence-type" class="form-label">Pasikartojimo tipas</label>
                            <select class="form-select" id="recurrence-type" name="recurrence_type">
                                <option value="daily">Kasdien</option>
                                <option value="weekly">Kas savaitę</option>
                                <option value="monthly">Kas mėnesį</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="recurrence-interval" class="form-label">Intervalas</label>
                            <input type="number" class="form-control" id="recurrence-interval" name="recurrence_interval" min="1" value="1">
                        </div>
                    </div>
                    
                    <div class="mb-3" id="weekly-options" style="display: none;">
                        <label class="form-label">Savaitės dienos</label>
                        <div class="d-flex flex-wrap">
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="0" id="sunday">
                                <label class="form-check-label" for="sunday">Sekmadienis</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="1" id="monday">
                                <label class="form-check-label" for="monday">Pirmadienis</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="2" id="tuesday">
                                <label class="form-check-label" for="tuesday">Antradienis</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="3" id="wednesday">
                                <label class="form-check-label" for="wednesday">Trečiadienis</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="4" id="thursday">
                                <label class="form-check-label" for="thursday">Ketvirtadienis</label>
                            </div>
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="5" id="friday">
                                <label class="form-check-label" for="friday">Penktadienis</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="weekdays[]" value="6" id="saturday">
                                <label class="form-check-label" for="saturday">Šeštadienis</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Užduoties parametrai -->
            <div class="form-section">
                <h4 class="section-title">Užduoties parametrai</h4>
                
                <div id="data-collection-params">
                    <div class="mb-3">
                        <label for="data-source" class="form-label">Duomenų šaltinis</label>
                        <select class="form-select" id="data-source" name="data_source">
                            <option value="binance">Binance</option>
                            <option value="coinbase">Coinbase</option>
                            <option value="kraken">Kraken</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="symbol" class="form-label">Kriptovaliutos simbolis</label>
                        <input type="text" class="form-control" id="symbol" name="symbol" value="BTC/USDT">
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="timeframe" class="form-label">Laiko intervalas</label>
                            <select class="form-select" id="timeframe" name="timeframe">
                                <option value="1m">1 minutė</option>
                                <option value="5m">5 minutės</option>
                                <option value="15m">15 minučių</option>
                                <option value="1h">1 valanda</option>
                                <option value="4h">4 valandos</option>
                                <option value="1d">1 diena</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="data-limit" class="form-label">Įrašų kiekis</label>
                            <input type="number" class="form-control" id="data-limit" name="data_limit" min="100" value="1000">
                        </div>
                    </div>
                </div>
                
                <div id="model-training-params" style="display: none;">
                    <div class="mb-3">
                        <label for="model-type" class="form-label">Modelio tipas</label>
                        <select class="form-select" id="model-type" name="model_type">
                            <option value="lstm">LSTM</option>
                            <option value="gru">GRU</option>
                            <option value="cnn">CNN</option>
                            <option value="transformer">Transformer</option>
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="epochs" class="form-label">Epochų skaičius</label>
                            <input type="number" class="form-control" id="epochs" name="epochs" min="1" value="50">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="batch-size" class="form-label">Batch dydis</label>
                            <input type="number" class="form-control" id="batch-size" name="batch_size" min="1" value="32">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="save-checkpoints" name="save_checkpoints" checked>
                            <label class="form-check-label" for="save-checkpoints">
                                Saugoti tarpinius modelius
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mb-5">
                <button type="submit" class="btn btn-primary btn-lg">Sukurti užduotį</button>
                <a href="{{ url_for('scheduler.calendar_view') }}" class="btn btn-outline-secondary btn-lg ms-2">Atšaukti</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Planavimo tipo pasikeitimo valdymas
        const scheduleType = document.getElementById('schedule-type');
        const oneTimeOptions = document.getElementById('one-time-options');
        const recurringOptions = document.getElementById('recurring-options');
        
        scheduleType.addEventListener('change', function() {
            if (this.value === 'one_time') {
                oneTimeOptions.style.display = 'block';
                recurringOptions.style.display = 'none';
            } else {
                oneTimeOptions.style.display = 'none';
                recurringOptions.style.display = 'block';
            }
        });
        
        // Pasikartojimo tipo pasikeitimo valdymas
        const recurrenceType = document.getElementById('recurrence-type');
        const weeklyOptions = document.getElementById('weekly-options');
        
        recurrenceType.addEventListener('change', function() {
            if (this.value === 'weekly') {
                weeklyOptions.style.display = 'block';
            } else {
                weeklyOptions.style.display = 'none';
            }
        });
        
        // Užduoties tipo pasikeitimo valdymas
        const taskType = document.getElementById('task-type');
        const dataCollectionParams = document.getElementById('data-collection-params');
        const modelTrainingParams = document.getElementById('model-training-params');
        
        taskType.addEventListener('change', function() {
            if (this.value === 'data_collection') {
                dataCollectionParams.style.display = 'block';
                modelTrainingParams.style.display = 'none';
            } else if (this.value === 'model_training') {
                dataCollectionParams.style.display = 'none';
                modelTrainingParams.style.display = 'block';
            } else {
                dataCollectionParams.style.display = 'none';
                modelTrainingParams.style.display = 'none';
            }
        });
        
        // Nustatome pradinę datą į šiandien
        document.getElementById('scheduled-date').valueAsDate = new Date();
    });
</script>
{% endblock %}